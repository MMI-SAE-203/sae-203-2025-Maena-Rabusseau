---
import { filterByGenre, sortedfilms } from "../../../backend/backend.mjs";
import Card from "../../components/Card.astro";
import Layout from "../../layouts/Layout.astro";
const film = Astro.props;
import Picture from "astro/components/Picture.astro";
import { addfilm } from '../../../backend/backend.mjs';


/*Filtrage d’une liste via une route dynamique permettant d’afficher uniquement les éléments correspondants, comme par exemple l’affichage des films par catégorie ou par langue.*/

let message = "";
let films = [];

if (Astro.request.method === "POST") {
    const data = await Astro.request.formData();
    const genre = data.get("genre") as string;

    if (genre) {
        films = await filterByGenre(genre);

        if (films.length === 0) {
            message = `Aucun film trouvé pour le genre "${genre}".`;
        } else {
            message = `Liste des films pour le genre "${genre}"`;
        }
    } else {
        message = "Veuillez sélectionner un genre.";
    }
} else {
    films = await sortedfilms();
    message = "Liste des films pour tous les genres";
}
---

<Layout>
    <!-- //Création des formulaires pour saisir et modifier des données. -->

    <h2 class="text-lg">Ajouter un film </h2>
    {message && <p class="text-red-600">{}</p>}
    <form action="/film/add" method="POST" enctype="multipart/form-data">
        <input
            type="text"
            name="Titre"
            placeholder="Titre du film"
            required
            class="w-full mt-2 p-2 border border-gray-300 rounded-md"
        />
      <input 
      type="text"
      name="Description"
      placeholder="Description du film"
      />
      <input 
      type="text"
      name="Genre"
      placeholder="Genre du film"
      />
     
      <input 
      type="text"
      name="Liste_des_acteurs"
      placeholder="Liste des acteurs"
      />
        <input type="file" name="images" />
        <button type="submit">Ajouter</button>
    </form> 

    <!-- Filtre par genre -->

    <form method="POST">
        <h2>Genre : </h2>
        <!-- <label for="genre">Genre :</label> -->
        <select name="genre" id="genre">
            <option value="">Sélectionnez un genre</option>
            <option value="Enfant">Enfant</option>
            <option value="Animation">Animation</option>
            <option value="Documentaire">Documentaire</option>
            <option value="Aventure">Aventure</option></select
        >
        <input type="submit" value="Filtrer par genre" />
    </form>

    <!-- Affichage d’une liste de collection -->

    <div class="flex justify-center list-none flex-wrap gap-4">
      
      <h1>Toutes les films</h1> 
        {films.map((film) => <Card {...film} />)}
    </div>




    <Layout />
